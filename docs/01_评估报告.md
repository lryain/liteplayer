# Liteplayer æ¨¡å—è¯„ä¼°æŠ¥å‘Š

**è¯„ä¼°æ—¥æœŸ**: 2026-02-11  
**è¯„ä¼°äºº**: GitHub Copilot  
**ç›®æ ‡**: è¯„ä¼°3rd/liteplayeræ¨¡å—æ˜¯å¦æ»¡è¶³åª’ä½“æ’­æ”¾å¼•æ“éœ€æ±‚

---

## 1. ç°çŠ¶åˆ†æ

### 1.1 ä»£ç åº“å®Œæ•´æ€§ âŒ

**é—®é¢˜**: liteplayerä»£ç åº“**ä¸å®Œæ•´**,ç¼ºå°‘å…³é”®ä¾èµ–åº“:

1. **ç¼ºå°‘ sysutils åº“**
   - è·¯å¾„: `thirdparty/sysutils/` ä»…åŒ…å«placeholderæ–‡ä»¶
   - éœ€è¦çš„æ–‡ä»¶:
     - `osal/unix/os_log.c`
     - `osal/unix/os_memory.c`
     - `osal/unix/os_thread.c`
     - `osal/unix/os_time.c`
     - `osal/unix/os_timer.c`
     - `osal/unix/os_misc.c`
     - `source/cutils/memdbg.c`
     - `source/cutils/mlooper.c`
     - `source/cutils/mqueue.c`
     - `source/cutils/ringbuf.c`
     - `source/cutils/swtimer.c`
     - `source/httpclient/httpclient.c`

2. **ç¼ºå°‘ mbedtls åº“**
   - è·¯å¾„: `thirdparty/mbedtls/` ä»…åŒ…å«placeholderæ–‡ä»¶
   - ç”¨äºHTTPSæ”¯æŒ

3. **ç¼ºå°‘ portaudio åº“**
   - è·¯å¾„: `thirdparty/portaudio/` ä»…åŒ…å«placeholderæ–‡ä»¶
   - ç”¨äºè·¨å¹³å°éŸ³é¢‘è¾“å‡º(macOSç­‰)

**åŸå› åˆ†æ**:
- liteplayer æ˜¯ä» GitHub ä»“åº“ https://github.com/sepnic/liteplayer å¤åˆ¶è¿‡æ¥çš„
- å¯èƒ½åªå¤åˆ¶äº†éƒ¨åˆ†ä»£ç ,æœªåŒ…å«å®Œæ•´çš„ç¬¬ä¸‰æ–¹ä¾èµ–
- æˆ–è€…åŸå§‹ä»“åº“ä½¿ç”¨git submoduleç®¡ç†ä¾èµ–,ä½†æœªæ­£ç¡®å…‹éš†

**ç¼–è¯‘é”™è¯¯**:
```
CMake Error at CMakeLists.txt:67 (add_library):
  Cannot find source file:
    /home/pi/dev/nora-xiaozhi-dev/3rd/liteplayer/thirdparty/sysutils/osal/unix/os_log.c
```

### 1.2 æ¶æ„è®¾è®¡è¯„ä¼° âœ…

ä»ç°æœ‰ä»£ç å’Œå¤´æ–‡ä»¶åˆ†æ,liteplayerçš„æ¶æ„è®¾è®¡**è‰¯å¥½**:

#### æ ¸å¿ƒç»„ä»¶

1. **liteplayer_main** - å•æ›²æ’­æ”¾å™¨
   - çŠ¶æ€æœº: IDLE â†’ INITED â†’ PREPARED â†’ STARTED â†’ PAUSED â†’ COMPLETED â†’ STOPPED
   - æ”¯æŒ: prepare, start, pause, resume, seek, stop, reset
   - ç±»ä¼¼Android MediaPlayeræ¥å£

2. **liteplayer_listplayer** - æ’­æ”¾åˆ—è¡¨æ’­æ”¾å™¨
   - æ‰©å±•å•æ›²æ’­æ”¾å™¨åŠŸèƒ½
   - æ”¯æŒæ’­æ”¾åˆ—è¡¨(.playlistæ–‡ä»¶)
   - æ”¯æŒ: switch_next, switch_prev, set_single_looping
   - è‡ªåŠ¨æ‰«æç›®å½•ç”Ÿæˆæ’­æ”¾åˆ—è¡¨

3. **liteplayer_ttsplayer** - TTSæ’­æ”¾å™¨
   - ä¸“é—¨ç”¨äºè¯­éŸ³åˆæˆæ•°æ®æµæ’­æ”¾
   - ä½å»¶è¿Ÿè®¾è®¡

4. **é€‚é…å™¨å±‚** (Adapter Layer)
   - **Source Wrapper**: æ•°æ®æºæŠ½è±¡
     - file_wrapper: æœ¬åœ°æ–‡ä»¶
     - httpclient_wrapper: HTTP/HTTPSæµ
     - static_wrapper: é™æ€æ•°æ®
   - **Sink Wrapper**: éŸ³é¢‘è¾“å‡ºæŠ½è±¡
     - alsa_wrapper: Linux ALSA
     - portaudio_wrapper: è·¨å¹³å°PortAudio
     - wave_wrapper: WAVæ–‡ä»¶è¾“å‡º

5. **è§£ç å™¨** (Decoder)
   - MP3: pv-mp3 (PacketVideo)
   - AAC: pv-aac (PacketVideo)
   - M4A: åŸºäºpv-aac
   - WAV: åŸç”Ÿæ”¯æŒ

#### è®¾è®¡ä¼˜ç‚¹

âœ… **æ¥å£æ¸…æ™°**: ä¸Android MediaPlayerä¸€è‡´çš„APIè®¾è®¡  
âœ… **ä½å¼€é”€**: 1-2ä¸ªçº¿ç¨‹,æœ€ä½48KBå†…å­˜å ç”¨  
âœ… **é«˜ç§»æ¤æ€§**: çº¯C99æ ‡å‡†,æ”¯æŒå¤šå¹³å°  
âœ… **å¯æ‰©å±•**: æŠ½è±¡çš„Source/Sinkæ¥å£,æ˜“äºæ·»åŠ æ–°åè®®  
âœ… **æ’­æ”¾åˆ—è¡¨**: åŸç”Ÿæ”¯æŒæ’­æ”¾åˆ—è¡¨åŠŸèƒ½  

#### è®¾è®¡ä¸è¶³

âŒ **å…ƒæ•°æ®ç¼ºå¤±**: æ— æ³•è§£ææ­Œæ›²æ ‡é¢˜ã€è‰ºæœ¯å®¶ã€ä¸“è¾‘ç­‰ID3æ ‡ç­¾  
âŒ **æ— æ ‡ç­¾ç³»ç»Ÿ**: ä¸æ”¯æŒæ­Œæ›²åˆ†ç±»(æµæ´¾ã€å¿ƒæƒ…ã€åœºæ™¯)  
âŒ **æ— æ¨èå¼•æ“**: æ²¡æœ‰æ’­æ”¾å†å²è®°å½•å’Œä¸ªæ€§åŒ–æ¨è  
âŒ **æ— å®šæ—¶åŠŸèƒ½**: ä¸æ”¯æŒå®šæ—¶æ’­æ”¾  
âŒ **æ— å‡è¡¡å™¨**: æ²¡æœ‰éŸ³é¢‘æ•ˆæœå¤„ç†  
âŒ **æ— æ­Œè¯åŠŸèƒ½**: ä¸æ”¯æŒæ­Œè¯æ˜¾ç¤ºå’ŒåŒæ­¥  
âŒ **æ’­æ”¾æ¨¡å¼å•ä¸€**: ä»…æ”¯æŒå•æ›²å¾ªç¯,æ— éšæœºæ’­æ”¾ã€åˆ—è¡¨å¾ªç¯ç­‰  

### 1.3 åŠŸèƒ½å¯¹æ¯”

| éœ€æ±‚åŠŸèƒ½ | liteplayerç°çŠ¶ | å·®è· |
|---------|---------------|-----|
| æ‰«ææ–‡ä»¶å¤¹å»ºç«‹æ’­æ”¾æ¸…å• | âœ… æ”¯æŒ(playlist_demo.c) | æ—  |
| æ’­æ”¾æ§åˆ¶(æ’­/æš‚/åœ/ä¸Š/ä¸‹) | âœ… å…¨éƒ¨æ”¯æŒ | æ—  |
| å¾ªç¯æ¨¡å¼ | âš ï¸ ä»…å•æ›²å¾ªç¯ | ç¼ºå°‘åˆ—è¡¨å¾ªç¯ã€éšæœºæ’­æ”¾ |
| æŒ‡å®šæ­Œå/æ­Œæ‰‹/ä¸“è¾‘æ’­æ”¾ | âŒ ä¸æ”¯æŒ | éœ€è¦å…ƒæ•°æ®è§£æå’Œæœç´¢åŠŸèƒ½ |
| æ ‡ç­¾ç­›é€‰æ’­æ”¾ | âŒ ä¸æ”¯æŒ | éœ€è¦æ ‡ç­¾ç®¡ç†ç³»ç»Ÿ |
| ä¸ªæ€§åŒ–æ¨è | âŒ ä¸æ”¯æŒ | éœ€è¦å†å²è®°å½•å’Œæ¨èç®—æ³• |
| å®šæ—¶æ’­æ”¾ | âŒ ä¸æ”¯æŒ | éœ€è¦å®šæ—¶å™¨åŠŸèƒ½ |
| å¤šæ ¼å¼æ— ç¼åˆ‡æ¢ | âœ… æ”¯æŒ | æ—  |
| éŸ³é¢‘å‡è¡¡å™¨ | âŒ ä¸æ”¯æŒ | éœ€è¦éŸ³é¢‘DSPå¤„ç† |
| æ­Œè¯æ˜¾ç¤º | âŒ ä¸æ”¯æŒ | éœ€è¦LRCè§£æå’ŒåŒæ­¥ |

---

## 2. ç»“è®ºä¸å»ºè®®

### 2.1 æ˜¯å¦æ»¡è¶³éœ€æ±‚?

**ç»“è®º**: liteplayer **ä¸èƒ½ç›´æ¥æ»¡è¶³**å®Œæ•´éœ€æ±‚,å­˜åœ¨ä»¥ä¸‹é—®é¢˜:

1. **ç¼–è¯‘ä¸é€šè¿‡**: ç¼ºå°‘å¿…è¦çš„ç¬¬ä¸‰æ–¹ä¾èµ–åº“
2. **åŠŸèƒ½ä¸å®Œæ•´**: ç¼ºå°‘å…ƒæ•°æ®ã€æ ‡ç­¾ã€æ¨èã€å‡è¡¡å™¨ç­‰é«˜çº§åŠŸèƒ½
3. **æ’­æ”¾æ¨¡å¼å•ä¸€**: ä»…æ”¯æŒå•æ›²å¾ªç¯,æ— éšæœºæ’­æ”¾ç­‰

### 2.2 å»ºè®®æ–¹æ¡ˆ

#### æ–¹æ¡ˆA: ä¿®å¤å¹¶æ‰©å±•liteplayer (æ¨è) â­

**ä¼˜ç‚¹**:
- åŸºäºè½»é‡çº§è®¾è®¡,é€‚åˆåµŒå…¥å¼å¹³å°
- æ¥å£è®¾è®¡ä¼˜ç§€,æ˜“äºæ‰©å±•
- ä»£ç è´¨é‡é«˜,ç»´æŠ¤æ€§å¥½

**å·¥ä½œé‡**:
1. **ä¿®å¤ä¾èµ–** (1-2å¤©)
   - ä»å®˜æ–¹ä»“åº“è·å–å®Œæ•´ä»£ç : https://github.com/sepnic/liteplayer
   - æˆ–æ‰‹åŠ¨å®ç°ç¼ºå¤±çš„sysutilsæ¥å£

2. **æ ¸å¿ƒåŠŸèƒ½æ‰©å±•** (3-5å¤©)
   - æ·»åŠ ID3æ ‡ç­¾è§£æ(ä½¿ç”¨libid3tagæˆ–è‡ªå®ç°)
   - å®ç°æ’­æ”¾æ¨¡å¼ç®¡ç†(éšæœºã€å¾ªç¯ã€é¡ºåº)
   - æ·»åŠ æ’­æ”¾å†å²è®°å½•
   - å®ç°æ–‡ä»¶å¤¹ç›‘æ§å’ŒåŠ¨æ€æ›´æ–°

3. **é«˜çº§åŠŸèƒ½å¼€å‘** (5-7å¤©)
   - æ ‡ç­¾ç®¡ç†ç³»ç»Ÿ(SQLiteæ•°æ®åº“)
   - ä¸ªæ€§åŒ–æ¨èç®—æ³•
   - å®šæ—¶æ’­æ”¾åŠŸèƒ½
   - LRCæ­Œè¯è§£æå’ŒåŒæ­¥

4. **ZMQæ¥å£** (2-3å¤©)
   - è®¾è®¡æ¶ˆæ¯åè®®
   - å®ç°ZMQæœåŠ¡ç«¯
   - ç¼–å†™æµ‹è¯•è„šæœ¬

5. **æµ‹è¯•å’Œæ–‡æ¡£** (2-3å¤©)
   - åŠŸèƒ½æµ‹è¯•
   - æ€§èƒ½æµ‹è¯•
   - ç¼–å†™ç”¨æˆ·æ‰‹å†Œ

**æ€»è®¡**: çº¦15-20å¤©

#### æ–¹æ¡ˆB: ä½¿ç”¨ç°æœ‰æˆç†Ÿåº“

æ›¿ä»£æ–¹æ¡ˆ:
- **MPD (Music Player Daemon)**: åŠŸèƒ½å®Œæ•´çš„éŸ³ä¹æœåŠ¡å™¨,ä½†è¾ƒé‡
- **GStreamer**: å¼ºå¤§çš„å¤šåª’ä½“æ¡†æ¶,å­¦ä¹ æ›²çº¿é™¡
- **FFmpeg + è‡ªå®šä¹‰**: çµæ´»ä½†éœ€è¦å¤§é‡å¼€å‘

**ä¸æ¨èåŸå› **:
- èµ„æºå ç”¨è¾ƒé«˜,ä¸é€‚åˆåµŒå…¥å¼
- é›†æˆå¤æ‚åº¦é«˜
- ä¸ç°æœ‰Dolyç³»ç»ŸZMQæ¶æ„é›†æˆå›°éš¾

#### æ–¹æ¡ˆC: ä»é›¶å®ç°

**ä¸æ¨èåŸå› **:
- å¼€å‘å‘¨æœŸé•¿(30+å¤©)
- é‡å¤é€ è½®å­
- liteplayerå·²ç»æä¾›è‰¯å¥½çš„åŸºç¡€

### 2.3 æ¨èæ‰§è¡Œæ­¥éª¤

é‡‡ç”¨**æ–¹æ¡ˆA**,åˆ†é˜¶æ®µå®æ–½:

**Phase 1: ä¿®å¤å’ŒåŸºç¡€æµ‹è¯•** (Week 1)
1. ä»GitHubå…‹éš†å®Œæ•´liteplayerä»“åº“
2. ç¼–è¯‘å¹¶è¿è¡Œplaylist_demo
3. éªŒè¯åŸºæœ¬æ’­æ”¾åŠŸèƒ½
4. ç¼–å†™è¯„ä¼°æŠ¥å‘Š(æœ¬æ–‡æ¡£)

**Phase 2: æ ¸å¿ƒåŠŸèƒ½å¼€å‘** (Week 2-3)
1. å®ç°æ’­æ”¾å¼•æ“æ ¸å¿ƒç±» MusicPlayerEngine
2. æ·»åŠ ID3æ ‡ç­¾è§£æ
3. å®ç°æ’­æ”¾æ¨¡å¼(éšæœºã€å¾ªç¯)
4. å®ç°æ’­æ”¾åˆ—è¡¨ç®¡ç†
5. æ·»åŠ æ–‡ä»¶å¤¹ç›‘æ§

**Phase 3: é«˜çº§åŠŸèƒ½** (Week 3-4)
1. æ ‡ç­¾ç®¡ç†ç³»ç»Ÿ
2. æ’­æ”¾å†å²å’Œæ¨è
3. å®šæ—¶æ’­æ”¾
4. é…ç½®æ–‡ä»¶ç®¡ç†

**Phase 4: ZMQæ¥å£å’Œæµ‹è¯•** (Week 4-5)
1. è®¾è®¡ZMQæ¶ˆæ¯åè®®
2. å®ç°ZMQæœåŠ¡
3. ç¼–å†™æµ‹è¯•è„šæœ¬
4. æ€§èƒ½ä¼˜åŒ–

**Phase 5: æ–‡æ¡£å’Œéƒ¨ç½²** (Week 5)
1. ç”¨æˆ·æ‰‹å†Œ
2. å¼€å‘è€…æ–‡æ¡£
3. æœåŠ¡åŒ–éƒ¨ç½²
4. é›†æˆåˆ°Dolyç³»ç»Ÿ

---

## 3. ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### 3.1 ç«‹å³è¡ŒåŠ¨ ğŸ”´

1. âœ… **è·å–å®Œæ•´liteplayerä»£ç **
   ```bash
   cd /home/pi/dev/nora-xiaozhi-dev/3rd
   mv liteplayer liteplayer.incomplete
   git clone --recursive https://github.com/sepnic/liteplayer.git
   ```

2. âœ… **éªŒè¯ç¼–è¯‘**
   ```bash
   cd liteplayer
   sudo apt-get install libasound2-dev  # å¦‚æœæœªå®‰è£…
   mkdir -p example/unix/out
   cd example/unix/out
   cmake ..
   make
   ```

3. âœ… **è¿è¡Œæµ‹è¯•**
   ```bash
   # å‡†å¤‡æµ‹è¯•éŸ³é¢‘æ–‡ä»¶
   mkdir -p ~/Music
   # ä¸‹è½½æˆ–å¤åˆ¶ä¸€äº›MP3æ–‡ä»¶åˆ° ~/Music
   
   # æµ‹è¯•æ’­æ”¾åˆ—è¡¨
   ./playlist_demo ~/Music
   ```

### 3.2 è¯„ä¼°åç»­ ğŸŸ¡

å®Œæˆä¸Šè¿°æµ‹è¯•å:
1. æ›´æ–°è¯„ä¼°æŠ¥å‘Š
2. ç¡®è®¤åŠŸèƒ½å¯ç”¨æ€§
3. åˆ¶å®šè¯¦ç»†çš„å¼€å‘è®¡åˆ’
4. å¼€å§‹Phase 2å¼€å‘

---

## 4. é£é™©è¯„ä¼°

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|-----|------|------|---------|
| å®Œæ•´ä»£ç ä»ç¼ºå¤±ä¾èµ– | ä½ | é«˜ | ä½¿ç”¨å®˜æ–¹READMEæŒ‡å¯¼çš„æ„å»ºæ–¹æ³• |
| ID3è§£æå›°éš¾ | ä¸­ | ä¸­ | ä½¿ç”¨æˆç†Ÿåº“libid3tagæˆ–taglib |
| æ€§èƒ½ä¸è¾¾æ ‡ | ä½ | ä¸­ | åŸºäºliteplayerä½å¼€é”€è®¾è®¡,æ€§èƒ½åº”è¯¥æ»¡è¶³ |
| ZMQé›†æˆé—®é¢˜ | ä½ | ä½ | Dolyç³»ç»Ÿå·²æœ‰æˆç†ŸZMQæ¶æ„å¯å‚è€ƒ |
| å¼€å‘å‘¨æœŸè¶…æœŸ | ä¸­ | ä¸­ | é‡‡ç”¨æ•æ·å¼€å‘,åˆ†é˜¶æ®µäº¤ä»˜MVP |

---

## é™„å½•A: å…³é”®æ¥å£åˆ†æ

### liteplayer_main API

```c
liteplayer_handle_t liteplayer_create();
int liteplayer_set_data_source(liteplayer_handle_t handle, const char *url);
int liteplayer_prepare(liteplayer_handle_t handle);
int liteplayer_start(liteplayer_handle_t handle);
int liteplayer_pause(liteplayer_handle_t handle);
int liteplayer_resume(liteplayer_handle_t handle);
int liteplayer_seek(liteplayer_handle_t handle, int msec);
int liteplayer_stop(liteplayer_handle_t handle);
int liteplayer_reset(liteplayer_handle_t handle);
int liteplayer_get_position(liteplayer_handle_t handle, int *msec);
int liteplayer_get_duration(liteplayer_handle_t handle, int *msec);
void liteplayer_destroy(liteplayer_handle_t handle);
```

### listplayer API (æ‰©å±•)

```c
listplayer_handle_t listplayer_create(struct listplayer_cfg *cfg);
int listplayer_switch_next(listplayer_handle_t handle);
int listplayer_switch_prev(listplayer_handle_t handle);
int listplayer_set_single_looping(listplayer_handle_t handle, bool enable);
// ... ç»§æ‰¿liteplayer_mainçš„æ‰€æœ‰æ¥å£
```

### çŠ¶æ€å›è°ƒ

```c
typedef int (*liteplayer_state_cb)(enum liteplayer_state state, int errcode, void *priv);

enum liteplayer_state {
    LITEPLAYER_IDLE,
    LITEPLAYER_INITED,
    LITEPLAYER_PREPARED,
    LITEPLAYER_STARTED,
    LITEPLAYER_PAUSED,
    LITEPLAYER_SEEKCOMPLETED,
    LITEPLAYER_NEARLYCOMPLETED,
    LITEPLAYER_COMPLETED,
    LITEPLAYER_STOPPED,
    LITEPLAYER_ERROR
};
```

---

## é™„å½•B: playlistæ–‡ä»¶æ ¼å¼

ç¤ºä¾‹ `music.playlist`:
```
/home/pi/Music/song1.mp3
/home/pi/Music/song2.m4a
/home/pi/Music/song3.wav
http://example.com/stream.mp3

```

- æ¯è¡Œä¸€ä¸ªURL(æœ¬åœ°æ–‡ä»¶æˆ–HTTPæµ)
- æ”¯æŒMP3, AAC, M4A, WAV
- æœ€åä¸€è¡Œå¿…é¡»æ˜¯ç©ºè¡Œ

---

**æŠ¥å‘Šç»“è®º**: liteplayerå…·æœ‰è‰¯å¥½çš„æ¶æ„åŸºç¡€,ä½†éœ€è¦è¡¥å…¨ä¾èµ–åº“å¹¶æ‰©å±•é«˜çº§åŠŸèƒ½æ‰èƒ½æ»¡è¶³å®Œæ•´éœ€æ±‚ã€‚å»ºè®®é‡‡ç”¨æ–¹æ¡ˆAä¿®å¤å¹¶æ‰©å±•liteplayerã€‚
